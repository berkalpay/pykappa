<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

<title>
  
  Tutorial — PyKappa
  
</title>

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css?v=ee3c7c2a" />
    <script src="_static/documentation_options.js?v=5929fcd5"></script>
    <script src="_static/doctools.js?v=fd6eb6e6"></script>
    <script src="_static/sphinx_highlight.js?v=6ffebe34"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@4/tex-mml-chtml.js"></script>
    <link rel="icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Examples" href="examples/index.html" />
    <link rel="prev" title="&lt;no title&gt;" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="Tutorial">
<h1>Tutorial<a class="headerlink" href="#Tutorial" title="Link to this heading">¶</a></h1>
<p>PyKappa works in terms of patterns, mixtures, and rules, and expressions, culminating in systems. Let’s see how the API works at each level.</p>
<section id="Patterns">
<h2>Patterns<a class="headerlink" href="#Patterns" title="Link to this heading">¶</a></h2>
<p>As in Kappa, patterns (subsets of a mixture on which rules can operate) can be broken down into components (a connected set of agents). Agents are typed objects with named sites, each of which has an internal state and possibly a binding partner – the site of another agent. All of these classes of objects can be constructed from Kappa strings using the <code class="docutils literal notranslate"><span class="pre">from_kappa</span></code> classmethod.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pykappa.pattern</span><span class="w"> </span><span class="kn">import</span> <span class="n">Agent</span><span class="p">,</span> <span class="n">Pattern</span><span class="p">,</span> <span class="n">Component</span>

<span class="c1"># Parse agents A and B from Kappa strings</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">Agent</span><span class="o">.</span><span class="n">from_kappa</span><span class="p">(</span><span class="s2">&quot;A(x[.])&quot;</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">Agent</span><span class="o">.</span><span class="n">from_kappa</span><span class="p">(</span><span class="s2">&quot;B(x[.])&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Agent A:&quot;</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">kappa_str</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Agent B:&quot;</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">kappa_str</span><span class="p">)</span>

<span class="c1"># Create an AB complex</span>
<span class="nb">complex</span> <span class="o">=</span> <span class="n">Component</span><span class="o">.</span><span class="n">from_kappa</span><span class="p">(</span><span class="s2">&quot;A(x[1]), B(x[1])&quot;</span><span class="p">)</span>
<span class="c1"># Or equivalently:</span>
<span class="nb">complex</span> <span class="o">=</span> <span class="n">Pattern</span><span class="o">.</span><span class="n">from_kappa</span><span class="p">(</span><span class="s2">&quot;A(x[1]), B(x[1])&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Complex&quot;</span><span class="p">,</span> <span class="nb">complex</span><span class="o">.</span><span class="n">kappa_str</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Agent A: A(x[.])
Agent B: B(x[.])
Complex A(x[1]), B(x[1])
</pre></div></div>
</div>
<p>Each agent in a mixture is essentially a node in a graph. PyKappa implements functions such as the ones below, identifying neighbors of an agent and checking whether a component embeds in another, or is in other words isomorphic to a subset of another.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">root</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="nb">complex</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Root agent type:&quot;</span><span class="p">,</span> <span class="n">root</span><span class="o">.</span><span class="n">type</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Neighbors of root:&quot;</span><span class="p">,</span> <span class="p">[</span><span class="n">neighbor</span><span class="o">.</span><span class="n">type</span> <span class="k">for</span> <span class="n">neighbor</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">neighbors</span><span class="p">])</span>

<span class="n">self_embeddings</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">complex</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="nb">complex</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Embeddings of complex in itself:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">self_embeddings</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Root agent type: A
Neighbors of root: [&#39;B&#39;]
Embeddings of complex in itself: 1
</pre></div></div>
</div>
</section>
<section id="Mixtures">
<h2>Mixtures<a class="headerlink" href="#Mixtures" title="Link to this heading">¶</a></h2>
<p>A mixture, like components and patterns, is a collection of agents, but one which facilitates the application of rules by efficiently updating embeddings according to changes in the mixture. Mixtures can be initialized and adjusted programatically, or again initialized from Kappa strings.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pykappa.mixture</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mixture</span>

<span class="n">mixture</span> <span class="o">=</span> <span class="n">Mixture</span><span class="p">()</span>
<span class="n">mixture</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="s2">&quot;A(x[.])&quot;</span><span class="p">,</span> <span class="n">n_copies</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">mixture</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="s2">&quot;B(x[.])&quot;</span><span class="p">,</span> <span class="n">n_copies</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">mixture</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="s2">&quot;A(x[1]), B(x[1])&quot;</span><span class="p">,</span> <span class="n">n_copies</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mixture as a Kappa string:</span><span class="se">\n</span><span class="si">{</span><span class="n">mixture</span><span class="o">.</span><span class="n">kappa_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Track a component pattern to query embeddings efficiently</span>
<span class="n">mixture</span><span class="o">.</span><span class="n">track_component</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;#AB embeddings (cached):&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mixture</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="nb">complex</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Mixture as a Kappa string:
%init: 2 B(x[1]), A(x[1])
%init: 3 A(x[.])
%init: 2 B(x[.])

#AB embeddings (cached): 2
</pre></div></div>
</div>
<p>By default, the mixture is unaware of the components of which it is composed: it has an agent-level view that is sufficient for simulation of basic rule applications. Some types of rules, such as those with distinct unimolecular and bimolecular rates, require component-level information, in which case component-tracking will be automatically enabled at system initialization. Enabling component-tracking also allows for efficient component-level queries.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">comp_mixture</span> <span class="o">=</span> <span class="n">Mixture</span><span class="p">(</span><span class="n">track_components</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">comp_mixture</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="s2">&quot;A(x[.])&quot;</span><span class="p">,</span> <span class="n">n_copies</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">comp_mixture</span><span class="o">.</span><span class="n">instantiate</span><span class="p">(</span><span class="s2">&quot;A(x[1]), B(x[1])&quot;</span><span class="p">)</span>

<span class="c1"># Iterate over all components</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Components in mixture:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">comp_mixture</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">component</span><span class="o">.</span><span class="n">kappa_str</span><span class="p">)</span>

<span class="c1"># Query embeddings within a specific component</span>
<span class="n">comp_mixture</span><span class="o">.</span><span class="n">track_component</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
<span class="n">mixture_component</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">comp_mixture</span><span class="o">.</span><span class="n">components</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">agents</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">embeddings_in_comp</span> <span class="o">=</span> <span class="n">comp_mixture</span><span class="o">.</span><span class="n">embeddings_in_component</span><span class="p">(</span><span class="nb">complex</span><span class="p">,</span> <span class="n">mixture_component</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Embeddings in the AB complex: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">embeddings_in_comp</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Components in mixture:
A(x[.])
A(x[1]), B(x[1])
A(x[.])

Embeddings in the AB complex: 1
</pre></div></div>
</div>
</section>
<section id="Rules">
<h2>Rules<a class="headerlink" href="#Rules" title="Link to this heading">¶</a></h2>
<p>Rules transform agents matched by their left-hand side into those specified by the right-hand side. Specifically, <code class="docutils literal notranslate"><span class="pre">rate(system)</span></code> evaluates the stochastic rate (possibly using variables), <code class="docutils literal notranslate"><span class="pre">n_embeddings(mixture)</span></code> counts applicable embeddings, and <code class="docutils literal notranslate"><span class="pre">select(mixture)</span></code> samples a specific embedding and returns a MixtureUpdate, which a mixture can then take to efficiently apply the corresponding update.</p>
<p>Let’s add a rule to bind <code class="docutils literal notranslate"><span class="pre">A</span></code> and <code class="docutils literal notranslate"><span class="pre">B</span></code> into <code class="docutils literal notranslate"><span class="pre">AB</span></code> and see how the mixture applies it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pykappa.rule</span><span class="w"> </span><span class="kn">import</span> <span class="n">KappaRule</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AB count before one binding event:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mixture</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="nb">complex</span><span class="p">)))</span>

<span class="n">bind</span> <span class="o">=</span> <span class="n">KappaRule</span><span class="o">.</span><span class="n">from_kappa</span><span class="p">(</span><span class="s2">&quot;A(x[.]), B(x[.]) -&gt; A(x[1]), B(x[1]) @ 1&quot;</span><span class="p">)</span>

<span class="c1"># Track the components on the left-hand side of the rule</span>
<span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">bind</span><span class="o">.</span><span class="n">left</span><span class="o">.</span><span class="n">components</span><span class="p">:</span>
    <span class="n">mixture</span><span class="o">.</span><span class="n">track_component</span><span class="p">(</span><span class="n">component</span><span class="p">)</span>

<span class="n">update</span> <span class="o">=</span> <span class="n">bind</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">mixture</span><span class="p">)</span>
<span class="n">mixture</span><span class="o">.</span><span class="n">apply_update</span><span class="p">(</span><span class="n">update</span><span class="p">)</span>

<span class="n">mixture</span><span class="o">.</span><span class="n">track_component</span><span class="p">(</span><span class="nb">complex</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;AB count after one binding event:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">mixture</span><span class="o">.</span><span class="n">embeddings</span><span class="p">(</span><span class="nb">complex</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
AB count before one binding event: 2
AB count after one binding event: 3
</pre></div></div>
</div>
</section>
<section id="Expressions">
<h2>Expressions<a class="headerlink" href="#Expressions" title="Link to this heading">¶</a></h2>
<p>Expressions in PyKappa represent algebraic formulas that can include literals, variables, operators, and component patterns. They are used for rule rates, observables, and variables. Expressions can be parsed from Kappa strings and evaluated in the context of a system.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pykappa.expression</span><span class="w"> </span><span class="kn">import</span> <span class="n">Expression</span>

<span class="n">literal_expr</span> <span class="o">=</span> <span class="n">Expression</span><span class="o">.</span><span class="n">from_kappa</span><span class="p">(</span><span class="s2">&quot;42&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Literal expression value:&quot;</span><span class="p">,</span> <span class="n">literal_expr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">())</span>

<span class="n">math_expr</span> <span class="o">=</span> <span class="n">Expression</span><span class="o">.</span><span class="n">from_kappa</span><span class="p">(</span><span class="s2">&quot;(2 + 3) * 4&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Math expression value:&quot;</span><span class="p">,</span> <span class="n">math_expr</span><span class="o">.</span><span class="n">evaluate</span><span class="p">())</span>

<span class="n">pattern_expr</span> <span class="o">=</span> <span class="n">Expression</span><span class="o">.</span><span class="n">from_kappa</span><span class="p">(</span><span class="s2">&quot;|A(x[1]), B(x[1])|&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Pattern expression:&quot;</span><span class="p">,</span> <span class="n">pattern_expr</span><span class="o">.</span><span class="n">kappa_str</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Literal expression value: 42
Math expression value: 20
Pattern expression: |A(x[1]), B(x[1])|
</pre></div></div>
</div>
<p>The last expression represents the number of AB complexes; it can be evaluated given a system as <code class="docutils literal notranslate"><span class="pre">pattern_expr.evaluate(system)</span></code>.</p>
</section>
<section id="Systems">
<h2>Systems<a class="headerlink" href="#Systems" title="Link to this heading">¶</a></h2>
<p>A system bundles a mixture with rules and observables and is used for simulation. Start with the reversible binding system in the Examples gallery to see how the API works at this highest level.</p>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.png" alt="Logo of PyKappa"/>
            </a></p>
<h1 class="logo"><a href="index.html">PyKappa</a></h1>











<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Patterns">Patterns</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Mixtures">Mixtures</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Rules">Rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Expressions">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Systems">Systems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">&lt;no title&gt;</a></li>
      <li>Next: <a href="examples/index.html" title="next chapter">Examples</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
<div class="footer" style="margin-bottom: 0">
  This work was funded by the John Templeton Foundation (grant no. 63448).
</div>

    <div class="footer">
      &#169;2025, PyKappa Developers.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 9.1.0</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/tutorial.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/berkalpay/pykappa" class="github">
        <img src="_static/github-banner.svg" alt="Fork me on GitHub" class="github"/>
    </a>
    

    
<style>
  .footer {
    margin-top: 0 !important;
  }
</style>

  </body>
</html>